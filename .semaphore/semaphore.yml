version: v1.0

name: Download Torrent and Upload to PixelDrain

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Download & Upload
    task:
      jobs:
        - name: Download and Upload Files
          commands:
            - checkout
            - echo "ðŸ“¦ Installing webtorrent-cli..."
            - sudo apt update
            - sudo apt install -y aria2
            - echo "ðŸ“¥ Downloading torrent..."
            - mkdir -p downloads 
            - curl -s https://klipit.in/ugq73679 | grep -oP 'magnet:\S+|https?://\S+\.(mp4|mkv|avi|srt|itorrents|torrenting)' > download_links.txt
            - wget --content-disposition -i download_links.txt 
            - aria2c --dir=downloads -i *.torrent 
            
            - echo "ðŸ“¤ Uploading files to PixelDrain..."
            - |
               find downloads -type f | while read file; do
                echo "Uploading $file..."
                response=$(curl -g -s -T "$file" -u :7275e391-9618-4a8e-a394-450c15698265 https://pixeldrain.com/api/file/)
                id=$(echo "$response" | grep -o '"id":"[^"]*"' | cut -d':' -f2 | tr -d '"')
                echo "âœ… $file uploaded: https://pixeldrain.com/u/$id"
                   done
